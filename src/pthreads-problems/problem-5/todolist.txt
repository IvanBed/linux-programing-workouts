Нужно дописать логику завершения потоков при сигнале завершения процесса.
Копать в сторону POSIX signal.